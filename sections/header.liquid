{% comment %} Styles {% endcomment %}
{% style %}
  #shopify-section-{{ section.id }} {
    /* Variables */
    --header-bg: transparent;
    --header-text-color: #fff;
    --header-btn-bg: transparent;
    --header-btn-text-color: #fff;
    --header-btn-border-color: #fff;


    position: {% unless section.settings.sticky_header_type == 'none' %}sticky{% else %}relative{% endunless %};
    top: 40px;
    width: 100%;
    {% if section.settings.show_line_separator %}
      border-bottom: 1px solid rgb(var(--color-foreground), 0.2);
    {% endif %}
    transition: top 150ms ease-out;
    margin-bottom: {{ section.settings.margin_bottom }}px;
    z-index: 20;
  }

  /* Header States */
  /* Scrolled */
  .header-wrapper {
     &.scrolled, &:hover {
      --header-bg: #fff;
      --header-text-color: #181818;

      .header__logo {
        filter: brightness(0);
      }

      #main-header {
        border-bottom: 2px solid #e1e1e1;
      }
     }
  }

  .header__quiz-button {
    background: var(--header-bg);
    border: 1px solid var(--header-text-color);
    color: var(--header-text-color);
    text-transform: uppercase;
    font-size: 1.4rem;
    padding: 1rem 1.6rem;
    letter-spacing: 0.15rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .header__quiz-button:hover {
    background: var(--header-text-color);
    color: var(--header-bg);
  }

  #main-header {
    display: grid;
    grid-template-columns: {% if section.settings.logo_position == 'middle-center' or section.settings.logo_position == 'top-center' %}
      1fr auto 1fr
    {% else %}
    auto 1fr auto
  {% endif %};
    align-items: center;
    gap: 0 3rem;
    margin-inline: auto;
    padding: 0 4rem;
    height: 86px;
    background: var(--header-bg);
    border-bottom: 2px solid transparent;
    transition: background 0.3s ease, border .3s ease;
  }
  #main-header:hover {
    background-color: #fff;
  }
  #main-header .header-shop_link {
    text-decoration: none;
    word-break: break-word;
  }
  #main-header .header-shop_name {
    font-size: 24px;
    font-weight: normal;
    margin: 0;
    line-height: 1;
  }
  {% if section.settings.logo_position == 'middle-center' %}
    #main-header nav {
      grid-area: 1 / 1;
    }
  {% elsif section.settings.logo_position == 'top-left' or section.settings.logo_position == 'top-center' %}
  #main-header nav {
    grid-area: 2 / span 3;
    padding-block: {{ section.settings.padding_bottom }}px;
  }
  {% endif %}
  #main-header nav ul {
    list-style: none;
    margin: 0;
    padding: 0;
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 6.4rem;
    height: 100%;
    color: var(--header-text-color)
  }
  nav{
    height: 100%;
  }
  nav ul{
    height: 100%;
  }

  .header__menu-item {
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
  }

  .underline-effect{
    position: relative;
  }

  .underline-effect::after{
    content: "";
    position: absolute;
    left: 50%;
    bottom: -5px;
    transform: translateX(-50%) scaleX(0);
    transform-origin: center;
    width: 100%;
    height: 1px;
    background-color: #000;
    transition: transform 0.3s ease;
  }

  .header__menu-item:hover > .underline-effect::after{
    transform: translateX(-50%) scaleX(1);
  }

  .header-menu-position-left ul {
    justify-content: flex-start;
  }
  .header-menu-position-center ul {
    justify-content: center;
  }
  .header-menu-position-right ul {
    justify-content: flex-end;
  }
  #main-header .header-drawer_icons,
  #main-header .menu-toggle {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 8px;
    cursor: pointer;
    border: 0;
    background: transparent;
    color: inherit;
    font-size: inherit;
  }
  #main-header .menu-toggle svg {
    width: 12px;
    height: auto;
    transition: 300ms ease;
  }
  #main-header .menu-toggle.menu-open svg {
    transform: scaleY(-1);
  }

  /* Header Logo */
  .header__logo {
    --logo-height: {{ settings.logo_height | append: 'px' }};
    width: auto;
    height: var(--logo-height);
    filter: brightness(0) invert(1);
    transition: filter .3s ease;
  }

  #main-header:hover .header-logo {
    filter: brightness(0);
  }
  {% if section.settings.sticky_header_type == 'reduce-logo-size' %}
    #shopify-section-{{ section.id }}
    .scrolled-header .header-logo {
      height: {{ settings.logo_height | minus: 10 | append: 'px' }};
    }
  {% endif %}
  #main-header nav a {
    text-decoration: none;
    color: inherit;
  }
  #main-header nav li,
  #main-header nav button {
    font-size: 1.4rem;
    letter-spacing: .15rem;
    text-transform: uppercase;
    font-weight: 500;
    transition: all .3s ease;
  }

  .header__cart-button {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: .6rem;
    cursor: pointer;
  }

  [data-cart-count] {
    font-size: 1.6rem;
    font-weight: 5  00;
    color: var(--header-text-color);
  }

  .header__account-button svg path,
  .header__cart-button svg path {
    stroke: var(--header-text-color);
  }

  .header__actions,
  .header__actions > * {
    display: flex;
    justify-content: flex-end;
    align-items: center;
    gap: 3.2rem;
    {% if section.settings.logo_position == 'top-left' or section.settings.logo_position == 'top-center' %}
      grid-area: 1 / 3;
    {% endif %}
    transition: color .3s ease;
  }

  #header__search-button {
    cursor: pointer;
  }
  #header__search-button svg path {
    fill: var(--header-text-color);
  }
  #header-search {
    position: absolute;
    inset: 0;
    color: rgb(var(--color-foreground));
    background: rgb(var(--color-background));
    display: none;
    justify-content: center;
    align-items: center;
    gap: 1rem;
  }

  #header-search.active {
    display: flex;
  }

  {%- if settings.predictive_search_enabled -%}
    #header-search predictive-search {
      position: relative;
      display: flex;
      width:min(750px, calc(100% - 3.5rem))
    }
    #predictive-search-wrapper {
      position: absolute;
      top: 100%;
      left: 0;
      background: rgb(var(--color-background));
      border: 1px solid rgba(var(--color-foreground),var(--color-background));
      border-top: 0;
      width: calc(100% - 2px);
      max-height: 80vh;
      overflow-y: auto;
      z-index: 1000;
    }
  {%- endif -%}

  #header-search form {
    position: relative;
    border: 1px solid rgb(var(--color-foreground), 0.2);
    width: min(750px, 100%);
    height: 40px;
    display: flex;
    justify-content: space-between;
    gap: 10px;
    padding-inline: 10px;
  }

  #header-search form input {
    width: 100%;
    border: 0;
    font-size: 15px;
    color: inherit;
    background: transparent;
    outline: none;
    box-shadow: none;
  }

  #header-search form input:-internal-autofill-selected{
    background-color: transparent;
  }

  /* clears the 'X' from Internet Explorer */
  #header-search form input[type='search']::-ms-clear,
  #header-search form input[type='search']::-ms-reveal {
      display: none;
      width: 0;
      height: 0;
  }

  #header-search .reset__button {
    position: relative;
    border: 1px solid rgba(var(--color-foreground),.2) !important;
    border-radius: 10rem;
    min-width: 16px;
    height: 16px;
    display: grid;
    place-items: center;
    align-self: center;
    margin: 0;
    margin-right: 15px;
  }

  #header-search .reset__button::before {
    content: '';
    position: absolute;
    right: -15px;
    width: 1px;
    height: calc(100% + 10px);
    background: rgba(var(--color-foreground),.08);
  }

  #header-search .reset__button svg.icon-close {
    width: 10px !important;
    height: auto;
  }

  /* clears the 'X' from Chrome */
  #header-search form input[type='search']::-webkit-search-decoration,
  #header-search form input[type='search']::-webkit-search-cancel-button,
  #header-search form input[type='search']::-webkit-search-results-button,
  #header-search form input[type='search']::-webkit-search-results-decoration {
      display: none;
  }
  #header-search button {
    background: transparent;
    border: 0;
    cursor: pointer;
    padding: 0;
  }
  #header-search svg {
    width: 20px;
    color: rgb(var(--color-foreground));
  }

  @media (max-width: 1280px) {
    #main-header nav ul{
      gap: 4.8rem;
    }

    .header-logo {
      --logo-height: {{ settings.logo_height | minus: 10 | append: 'px' }};
    }
  }

  @media (max-width: 1180px) {
    #main-header nav ul{
      gap: 3.2rem;
    }
    .header-logo {
      --logo-height: 36px;
    }
  }

  @media (min-width: 1091px) {
    {% unless section.settings.menu_type_desktop == 'drawer' %}
      #header-drawer {
        display: none;
      }
    {% endunless %}
  }

  @media (max-width: 1090px) {
    #main-header > nav,
    .header__localization,
    .header__quiz,
    #header__search-button {
      display: none;
    }
    #main-header {
      grid-template-columns:
      {% if section.settings.mobile_logo_position == 'center' %}
        1fr auto 1fr
      {% else %}
        auto 1fr auto
      {% endif %};
      padding: {{ section.settings.padding_top | divided_by: 1.5 }}px 20px {{ section.settings.padding_bottom | divided_by: 1.5 }}px;
    }
    #header-search predictive-search {
      position: static;
    }
    #predictive-search-wrapper {
        border-top: 1px solid rgba(var(--color-foreground),var(--color-background));
    }
  }
  @media (min-width: 1025px) {
    .header-menu-position-center {
      display: grid;
    }
    .header-menu-position-center .header-logo-container,
    .header-menu-position-center .header__actions
    {
      min-width: 160px;
    }
  }
  @media (max-width: 1024px) {
    .header-wrapper {
    --header-bg: #fff;
      --header-text-color: #181818;
    }
    .header__logo {
      filter: brightness(0);
      --logo-height: 42px;
    }
  }

  @media (max-width: 768px) {
    .header__logo {
      --logo-height: 36px;
    }

    .header__actions {
      gap: 1.6rem;
    }
  }
{% endstyle %}

{% capture header_search %}
  <div id="header__search-button" @click="searchOpen = !searchOpen; $nextTick(() => { if (searchOpen) $refs.searchInput.focus() })">
    {{ 'icon-search.svg' | inline_asset_content }}
  </div>
{% endcapture %}

{% comment %} HTML {% endcomment %}
<div
  class="color-{{ section.settings.color_scheme }} header-wrapper"
  x-data="
    {
      {% if settings.cart_type == 'drawer' %}
        cartOpen: false,
      {% endif %}
      scrolled: false
    }
  "
  {% if settings.cart_type == 'drawer' %}
    @cart-open.window="cartOpen = true"
  {% endif %}
  @scroll.window="scrolled = window.scrollY > 0"
  :class="{ 'scrolled': scrolled }"
>
  <header
    {% if section.settings.menu_position == 'center' %}
      class="header-menu-position-center"
    {% endif %}
    id="main-header"
    x-data="{ searchOpen: false, searchTerm: '{{ search.terms | escape }}' }"
    @click.outside="searchOpen = false"
  >
    {% render 'component-nav-drawer',
      menu: section.settings.menu,
      menu_color_scheme: section.settings.menu_color_scheme,
      enable_country_selector: section.settings.enable_country_selector,
      enable_language_selector: section.settings.enable_language_selector,
      enable_customer_avatar: section.settings.enable_customer_avatar
    %}

    {% if section.settings.logo_position == 'top-center' or section.settings.menu == blank %}
      {{ header_search }}
    {% endif %}

    {% if request.page_type == 'index' %}<h1 class="header-logo-container" style="margin: 0">{% endif %}
    <a href="{{ routes.root_url }}" class="header-shop_link" style="display: flex">
      {% if settings.logo != blank %}
        {{ settings.logo | image_url: width: 900 | image_tag: class: 'header__logo' }}
      {% else %}
        <span class="header-shop_name">{{ shop.name }}</span>
      {% endif %}
    </a>
    {% if request.page_type == 'index' %}</h1>{% endif %}

    {% if section.settings.menu != blank and section.settings.menu_type_desktop != 'drawer' %}
      <nav class="header-menu-position-{{ section.settings.menu_position }}">
        {% if section.settings.menu_type_desktop == 'dropdown' %}
          {% render 'component-nav-dropdown',
            nav_style: 'dropdown',
            menu: section.settings.menu,
            menu_color_scheme: section.settings.menu_color_scheme
          %}
        {% elsif section.settings.menu_type_desktop != 'drawer' %}
          {% render 'component-nav-megamenu',
            menu: section.settings.menu,
            menu_color_scheme: section.settings.menu_color_scheme
          %}
        {% endif %}
      </nav>
    {% endif %}

    {% comment %} Header actions {% endcomment %}
    <div class="header__actions">
      {% comment %} Search button {% endcomment %}
      {% unless section.settings.logo_position == 'top-center' or section.settings.menu == blank %}
        {{ header_search }}
      {% endunless %}

      {% comment %} Localization form {% endcomment %}
      {% if section.settings.enable_country_selector or section.settings.enable_language_selector %}
        <div class="header__localization">
          {%- render 'component-localization-form',
            enable_country_selector: section.settings.enable_country_selector,
            enable_language_selector: section.settings.enable_language_selector,
            menu_color_scheme: section.settings.menu_color_scheme
          -%}
        </div>
      {% endif %}

      {% comment %} Quiz button {% endcomment %}
      <div class="header__quiz">
        <button class="header__quiz-button">Take our quiz</button>
      </div>

      {% comment %} Customer account {% endcomment %}
      {% if shop.customer_accounts_enabled and section.settings.enable_customer_avatar %}
        <a
          class="header__account-button"
          href="{% if customer %}{{ routes.account_url }}{% else %}{{ routes.account_login_url }}{% endif %}"
          rel="nofollow"
        >
          {{- 'icon-account.svg' | inline_asset_content -}}
        </a>
      {% endif %}

      {% comment %} Apps {% endcomment %}
      {%- for block in section.blocks -%}
        {%- case block.type -%}
          {%- when '@app' -%}
            {% render block %}
        {%- endcase -%}
      {%- endfor -%}

      {% comment %} Cart {% endcomment %}
      <a
        {%- if settings.cart_type == 'drawer' -%}
          @click.prevent="cartOpen = !cartOpen"
        {%- else -%}
          href="{{ routes.cart_url }}"
        {%- endif -%}
      >
        <div class="header__cart-button">
          {{- 'icon-cart.svg' | inline_asset_content -}}
          <p data-cart-count data-ajax-cart-bind="item_count">{{ cart.item_count }}</p>
        </div>
      </a>
    </div>

    {% comment %} Search form {% endcomment %}
    <div id="header-search" :class="{ 'active': searchOpen }">
      {%- if settings.predictive_search_enabled -%}
        {%- render 'component-predictive-search', context: 'header' -%}
      {%- else -%}
        <form action="{{ routes.search_url }}" method="get" role="search">
          <input
            type="search"
            name="q"
            value="{{ search.terms | escape }}"
            placeholder="Search"
            x-model="searchTerm"
            x-ref="searchInput"
            x-show="searchOpen"
            @focus="$event.target.select()"
          >
          <button
            type="reset"
            class="reset__button"
            aria-label="Clear search term"
            @click="searchTerm = ''"
            x-show="searchTerm.length > 0"
            x-transition
            x-cloak
          >
            {{- 'icon-close.svg' | inline_asset_content -}}
          </button>
          <button aria-label="Search">
            {{- 'icon-search.svg' | inline_asset_content -}}
          </button>
        </form>
      {%- endif -%}
      <button id="close-header-search" @click="searchOpen = !searchOpen">
        {{- 'icon-close.svg' | inline_asset_content -}}
      </button>
    </div>
  </header>

  {% comment %} Cart notification {% endcomment %}
  {%- if settings.cart_type == 'notification' -%}
    {%- render 'component-cart-notification',
      color_scheme: section.settings.color_scheme,
      desktop_menu_type: section.settings.menu_type_desktop
    -%}
  {%- endif -%}

  {%- if settings.cart_type == 'drawer' -%}
    {%- render 'component-cart-drawer' -%}
  {%- endif -%}
</div>

{% comment %} JavaScript {% endcomment %}

{% if section.settings.enable_country_selector or section.settings.enable_language_selector %}
  <script src="{{ 'component-localization-form.js' | asset_url }}" type="module"></script>
{% endif %}

{% comment %} Schema {% endcomment %}

{% schema %}
{
  "name": "t:sections.header.name",
  "class": "section-header",
  "settings": [
    {
      "type": "select",
      "id": "logo_position",
      "options": [
        {
          "value": "top-left",
          "label": "t:sections.header.settings.logo_position.options__2.label"
        },
        {
          "value": "top-center",
          "label": "t:sections.header.settings.logo_position.options__3.label"
        },
        {
          "value": "middle-left",
          "label": "t:sections.header.settings.logo_position.options__1.label"
        },
        {
          "value": "middle-center",
          "label": "t:sections.header.settings.logo_position.options__4.label"
        }
      ],
      "default": "middle-left",
      "label": "t:sections.header.settings.logo_position.label",
      "info": "t:sections.header.settings.logo_help.content"
    },
    {
      "type": "select",
      "id": "menu_position",
      "label": "Menu position",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "center", "label": "Center" },
        { "value": "right", "label": "Right" }
      ],
      "default": "center"
    },
    {
      "type": "link_list",
      "id": "menu",
      "default": "main-menu",
      "label": "t:sections.header.settings.menu.label"
    },
    {
      "type": "select",
      "id": "menu_type_desktop",
      "options": [
        {
          "value": "dropdown",
          "label": "t:sections.header.settings.menu_type_desktop.options__1.label"
        },
        {
          "value": "mega",
          "label": "t:sections.header.settings.menu_type_desktop.options__2.label"
        },
        {
          "value": "drawer",
          "label": "t:sections.header.settings.menu_type_desktop.options__3.label"
        }
      ],
      "default": "dropdown",
      "label": "t:sections.header.settings.menu_type_desktop.label",
      "info": "t:sections.header.settings.menu_type_desktop.info"
    },
    {
      "type": "select",
      "id": "sticky_header_type",
      "options": [
        {
          "value": "none",
          "label": "t:sections.header.settings.sticky_header_type.options__1.label"
        },
        {
          "value": "on-scroll-up",
          "label": "t:sections.header.settings.sticky_header_type.options__2.label"
        },
        {
          "value": "always",
          "label": "t:sections.header.settings.sticky_header_type.options__3.label"
        },
        {
          "value": "reduce-logo-size",
          "label": "t:sections.header.settings.sticky_header_type.options__4.label"
        }
      ],
      "default": "on-scroll-up",
      "label": "t:sections.header.settings.sticky_header_type.label"
    },
    {
      "type": "checkbox",
      "id": "show_line_separator",
      "default": true,
      "label": "t:sections.header.settings.show_line_separator.label"
    },
    {
      "type": "header",
      "content": "t:sections.header.settings.header__1.content"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:sections.all.colors.label",
      "default": "scheme-1"
    },
    {
      "type": "color_scheme",
      "id": "menu_color_scheme",
      "label": "t:sections.header.settings.menu_color_scheme.label",
      "default": "scheme-1"
    },
    {
      "type": "header",
      "content": "t:sections.header.settings.header__3.content",
      "info": "t:sections.header.settings.header__4.info"
    },
    {
      "type": "checkbox",
      "id": "enable_country_selector",
      "default": false,
      "label": "t:sections.header.settings.enable_country_selector.label"
    },
    {
      "type": "header",
      "content": "t:sections.header.settings.header__5.content",
      "info": "t:sections.header.settings.header__6.info"
    },
    {
      "type": "checkbox",
      "id": "enable_language_selector",
      "default": false,
      "label": "t:sections.header.settings.enable_language_selector.label"
    },
    {
      "type": "header",
      "content": "t:sections.header.settings.header__7.content",
      "info": "t:sections.header.settings.header__7.info"
    },
    {
      "type": "checkbox",
      "id": "enable_customer_avatar",
      "default": true,
      "label": "t:sections.header.settings.enable_customer_avatar.label",
      "info": "t:sections.header.settings.enable_customer_avatar.info"
    },
    {
      "type": "header",
      "content": "t:sections.header.settings.mobile_layout.content"
    },
    {
      "type": "select",
      "id": "mobile_logo_position",
      "options": [
        {
          "value": "center",
          "label": "t:sections.header.settings.mobile_logo_position.options__1.label"
        },
        {
          "value": "left",
          "label": "t:sections.header.settings.mobile_logo_position.options__2.label"
        }
      ],
      "default": "center",
      "label": "t:sections.header.settings.mobile_logo_position.label"
    },
    {
      "type": "header",
      "content": "t:sections.all.spacing"
    },
    {
      "type": "range",
      "id": "margin_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:sections.header.settings.margin_bottom.label",
      "default": 0
    },
    {
      "type": "header",
      "content": "t:sections.all.padding.section_padding_heading"
    },
    {
      "type": "range",
      "id": "padding_vertical",
      "min": 0,
      "max": 36,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_vertical",
      "default": 20
    },
    {
      "type": "range",
      "id": "padding_horizontal",
      "min": 0,
      "max": 36,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_horizontal",
      "default": 20
    }
  ],
  "blocks": [
    {
      "type": "megamenu",
      "name": "Mega Menu",
      "settings": [
        {
          "type": "text",
          "id": "menu_handle",
          "label": "Menu link handle (e.g. about etc )"
        },
        {
          "type": "text",
          "id": "menu_title",
          "label": "Menu title"
        }
      ]
    },
    {
      "type": "megamenu_item",
      "name": "Mega Menu Item",
      "settings": [
        {
          "type": "text",
          "id": "parent_menu_handle",
          "label": "Parent Mega Menu handle"
        },
        {
          "type": "image_picker",
          "id": "item_image",
          "label": "Item image"
        },
        {
          "type": "range",
          "id": "item_image_width",
          "label": "Item image width",
          "min": 100,
          "max": 500,
          "step": 5,
          "default": 250
        },
        { 
          "type": "text",
          "id": "item_title",
          "label": "Item title"
        },
        {
          "type": "url",
          "id": "item_link",
          "label": "Item link"
        }
      ]
    }
  ]
}
{% endschema %}
